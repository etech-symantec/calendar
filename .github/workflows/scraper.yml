name: Daily Web Scraper

on:
  schedule:
    # ğŸŒŸ í•œêµ­ ì‹œê°„ ì˜¤ì „ 8ì‹œëŠ” UTCë¡œ ì „ë‚  ë°¤ 23ì‹œì…ë‹ˆë‹¤. (8 - 9 = -1)
    - cron: '0 23 * * *'
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë²„íŠ¼ í™œì„±í™” (í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í•„ìˆ˜!)

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest # ê°€ìƒ ë¦¬ëˆ…ìŠ¤ í™˜ê²½ì—ì„œ ì‹¤í–‰

    steps:
      - name: 1. ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ê°€ì ¸ì˜¤ê¸° (Checkout)
        uses: actions/checkout@v4

      - name: 2. Python í™˜ê²½ ì„¸íŒ…
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 3. íŒ¨í‚¤ì§€ ë° ë¸Œë¼ìš°ì € ì„¤ì¹˜ (Playwright & Chromium)
        run: |
          python -m pip install --upgrade pip
          pip install playwright requests
          playwright install chromium

      - name: 4. íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì›¹ ìŠ¤í¬ë˜í•‘ -> index.html ìƒì„±)
        env: # â¬…ï¸ ì´ ë¶€ë¶„ì„ ì¶”ê°€í•©ë‹ˆë‹¤! (ê¸ˆê³ ì—ì„œ êº¼ë‚´ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬)
          MY_SITE_ID: ${{ secrets.MY_SITE_ID }}
          MY_SITE_PW: ${{ secrets.MY_SITE_PW }}
          JANDI_WEBHOOK_URL: ${{ vars.JANDI_WEBHOOK_URL }}
        run: python scraper.py
        
      - name: 5. ë³€ê²½ëœ HTML íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html
          # ë³€ê²½ ì‚¬í•­ì´ ì—†ì„ ê²½ìš° ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šë„ë¡ ì˜ˆì™¸ ì²˜ë¦¬
          git commit -m "Auto-update: ìµœì‹  í…Œì´ë¸” ë°ì´í„° ê°±ì‹ " || echo "No changes to commit"
          git push
